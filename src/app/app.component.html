<div
  id="app"
  class="d-flex flex-column w-100">
  <mat-accordion
    class="w-100"
    *ngIf="(powerPlants|async)"
  >
    <mat-expansion-panel
      *ngFor="let pp of (powerPlants|async)"
      [expanded]="activePp === pp.id"
      (opened)="activePp= pp.id"
      hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title class="w-30">
          <span>{{pp.ppName}}</span>
        </mat-panel-title>
        <mat-panel-description  class="d-flex w-100 justify-content-between">
          <span
            [matTooltip]="craftHHList(pp.connectedHH)">{{pp.connectedHH.length ? 'Connected households:\&nbsp;\&nbsp;' + pp.connectedHH.length : 'No connected households'}}</span>
          <mat-icon
            id="ppState"
            class="mr-4"
            [class.active]="pp.isActive"
          >lens</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <div class="d-flex w-100 justify-content-between">
        <mat-form-field class="example-chip-list">
          <mat-chip-list #chipList aria-label="Fruit selection">
            <mat-chip
              *ngFor="let hh of pp.connectedHH"
              [selectable]="selectable"
              [removable]="removable"
              (removed)="remove(hh.id, pp.id)">
              {{hh.hhName}}
              <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
            </mat-chip>
            <input
              placeholder="New fruit..."
              #hhInput
              [formControl]="formControl"
              [matAutocomplete]="auto"
              [matChipInputFor]="chipList"
              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              (matChipInputTokenEnd)="add($event)">
          </mat-chip-list>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
            <mat-option *ngFor="let fruit of filteredFruits | async" [value]="fruit">
              {{fruit}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
        <button
          mat-raised-button
          class="mw-100-px"
          [class.activeBtn]="!pp.isActive"
          (click)="pp.isActive ? openDialog(pp.connectedHH, 'deactivate', pp) : openDialog(pp.connectedHH, 'activate', pp)"
          color="warn">{{pp.isActive ? 'Deactivate' : 'Activate'}}</button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
  <mat-table
    class="mt-3"
    [dataSource]="households|async">
    <ng-container matColumnDef="1">
      <mat-header-cell *matHeaderCellDef> No. </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element.hhName}} </mat-cell>
    </ng-container>
    <ng-container matColumnDef="2">
      <mat-header-cell *matHeaderCellDef> No. </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element.id}} </mat-cell>
    </ng-container>
    <ng-container matColumnDef="3">
      <mat-header-cell *matHeaderCellDef> No. </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element.connectedPP}} </mat-cell>
    </ng-container>
    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>

</div>
